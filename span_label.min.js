function update_record(){let final_record=document.querySelector("#final_record");final_record.value=record}function showResult(){for(const type in record){let container=document.querySelector(`#${type}_result`);var html=`<table class='table'><thead><tr><th scope="col" style="width:60px">ID</th><th scope="col">Text</th><th scope="col" style="width:70px">Delete</th></tr></thead>`;for(const r in record[type])e=record[type][r],html+=`<tr><td style="text-align:right">${r.toString()}</td><td style="text-align:left">${e.text}</td><td><button type="button" class="btn btn-sm btn-danger" onclick="delete_span('${type}', ${r})">X</button></td></tr>`;html+="</table>",container.innerHTML=html}update_record()}function add_span(node,text,start=0){0!=start&&(counter=start);const raw_text=node.dataset.text;start=raw_text.search(text);-1!==start&&(new Mark(node).mark(text,{separateWordSearch:!1,className:`${node.id}_mark_${counter.toString()}`}),record[node.id][counter]={start:start,end:raw_text.search(text)+text.length,text:text},counter+=1,showResult())}function delete_span(type,id){for(;document.querySelector(`.${type}_mark_${id.toString()}`);)new Mark(document.querySelector(`.${type}_mark_${id.toString()}`)).unmark();record[type][id].text;delete record[type][id],showResult()}function start_span_labeling(){document.querySelector("#span_labeling").style.display="block",document.querySelector("#relation_btn").style.display="inline-block",document.querySelector("#instruction_btn").innerHTML="View instructions"}counter=1,record={recalled:{},retold:{}},$(document).ready(()=>{document.addEventListener("mouseup",event=>{var node,text=window.getSelection();text.baseNode&&("recalled"!=(node=text.baseNode.parentElement).id&&"retold"!=node.id||(text=text.toString())&&add_span(node,text))}),showResult()});