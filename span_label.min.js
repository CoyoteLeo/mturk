function update_record(){let final_record=document.querySelector("#final_record");final_record.value=record}function showResult(){for(const type in record){let container=document.querySelector(`#${type}_result`);var html=`<table class='table'><thead><tr><th scope="col">ID</th><th scope="col">Start</th><th scope="col">End</th><th scope="col">Text</th><th scope="col">Delete</th></tr></thead>`;for(const r in record[type])e=record[type][r],html+=`<tr><td>${r.toString()}</td><td>${e.start}</td><td>${e.end}</td><td>${e.text}</td><td style="text-align:center"><button type="button" class="btn btn-sm btn-danger" onclick="delete_span('${type}', ${r})">X</button></td></tr>`;html+="</table>",container.innerHTML=html}update_record()}function delete_span(type,id){record[type][id].text;new Mark(document.querySelector(`.${type}_mark_${id.toString()}`)).unmark(),delete record[type][id],showResult()}counter=0,record={recalled:{},retold:{}},$(document).ready(()=>{["#recalled","#retold"].forEach(story_type=>{let e=$(story_type)[0];e.innerHTML=e.dataset.text}),document.addEventListener("mouseup",event=>{var node,text,raw_text,start=window.getSelection();start.baseNode&&("recalled"!=(node=start.baseNode.parentElement).id&&"retold"!=node.id||(!(text=start.toString())||-1!==(start=(raw_text=node.dataset.text).search(text))&&(new Mark(node).mark(text,{separateWordSearch:!1,className:`${node.id}_mark_${counter.toString()}`}),record[node.id][counter]={start:start,end:raw_text.search(text)+text.length,text:text},counter+=1,showResult())))}),showResult()});