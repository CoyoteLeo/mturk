function isNormalInteger(str){if(!(str=str.trim()))return!1;str=str.replace(/^0+/,"")||"0";var n=Math.floor(Number(str));return n!==1/0&&String(n)===str&&0<=n}function validate_type(e){var is_valid=["match","conflict","added"].includes(e.value)?(e.classList.remove("is-invalid"),!0):(e.classList.add("is-invalid"),!1);let input=document.querySelector("#recalled_ids");return"added"==e.value?(input.placeholder="",input.value="",input.disabled=!0):(input.placeholder="e.g. 1,2,5",input.disabled=!1),is_valid}function validate_ids(e,valids_ids){if(!e.value)return e.nextElementSibling.innerHTML="Fill the field with the correct pattern.",e.classList.add("is-invalid"),!1;let ids=e.value.split(",").filter(e=>e);return ids.every(isNormalInteger)?(ids=ids.map(e=>parseInt(e)),ids.every(v=>valids_ids.includes(v))?(e.classList.remove("is-invalid"),!0):(e.nextElementSibling.innerHTML="Include invalid ids",e.classList.add("is-invalid"),!1)):(e.nextElementSibling.innerHTML="Fill the field with the correct pattern.",e.classList.add("is-invalid"),!1)}function validate_relation(){if(validate_type(is_retold_valid=document.querySelector("#type_selection"))){var relation_type=is_retold_valid.value;const recalled_ids_ele=document.querySelector("#recalled_ids"),retold_ids_ele=document.querySelector("#retold_ids");var is_recall_valid=Object.keys(record.recalled).map(e=>parseInt(e)),is_retold_valid=Object.keys(record.retold).map(e=>parseInt(e)),is_recall_valid=validate_ids(recalled_ids_ele,is_recall_valid),is_retold_valid=validate_ids(retold_ids_ele,is_retold_valid);if("added"==relation_type){if(recalled_ids_ele.value?(recalled_ids_ele.nextElementSibling.innerHTML="Please keep the field blank",recalled_ids_ele.classList.add("is-invalid")):recalled_ids_ele.classList.remove("is-invalid"),!is_retold_valid)return}else if(!is_recall_valid||!is_retold_valid)return;return!0}}function delete_relation(id){let e=document.querySelector(`#relation${id}`);e.remove(),delete relations[id],document.querySelector("#final_relation").value=relations}function build_html(ids,r){if(0==ids.length)return"";let html="<table>";for(const i in ids)id=ids[i],html+=`<tr><td style="width:60px;"text-align:right"">${id}:</td><td style="text-align:left">${r[id].text}</td></tr>`;return html+="</table>",html}function add_relation(){if(validate_relation()){let table=document.querySelector("#relation_result"),tr=document.createElement("tr");tr.id=`relation${relation_counter}`;const type_ele=document.querySelector("#type_selection"),recalled_ids_ele=document.querySelector("#recalled_ids"),retold_ids_ele=document.querySelector("#retold_ids");var relation_type=type_ele.value,recalled_ids=recalled_ids_ele.value.split(",").filter(e=>e).map(e=>parseInt(e)),retold_ids=retold_ids_ele.value.split(",").filter(e=>e).map(e=>parseInt(e)),recalled_table=build_html(recalled_ids,record.recalled),retold_table=build_html(retold_ids,record.retold);tr.innerHTML=`<td>${relation_type}</td><td>${recalled_table}</td><td>${retold_table}</td><td><button type="button" class="btn btn-sm btn-danger" style="background-color: #dc3545"onclick=delete_relation(${relation_counter})>X</button></td>`,table.append(tr),relations[relation_counter]={type:relation_type,recalled_ids:recalled_ids,retold_ids:retold_ids},document.querySelector("#final_relation").value=relations,type_ele.value="--",recalled_ids_ele.value="",retold_ids_ele.value="",relation_counter+=1}}function start_relation_tagging(){document.querySelector("#relation_btn").style.display="none",document.querySelector("#relation_labeling").style.display="block"}relation_counter=1,relations={};